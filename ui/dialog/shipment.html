{% extends 'layout/dialog.html' %}
{% import 'macros.twig' as scat %}

{% block title %}
  Shipment
{% endblock %}

{% block body %}
  {% if easypost %}
    {% set tracker= easypost.tracker %}
  {% endif %}

  <div class="modal-body">

    <div class="form-group">
      <label class="control-label">Status</label>
      <p class="form-control-static">
        {{ scat.format_shipping_status(shipment.status) }}
      </p>
    </div>

    <div class="form-group">
      <label class="control-label">Dimensions</label>
      <p class="form-control-static">
        {% if shipment.length %}
          {{ shipment.length }}" &times;
          {{ shipment.width }}" &times;
          {{ shipment.height }}"
        {% else %}
          Unknown
        {% endif %}
        {% if easypost.parcel.predefined_package %}
          &bull; {{ easypost.parcel.predefined_package }}
        {% endif %}
      </p>
    </div>

    <div class="form-group">
      <label class="control-label">Weight</label>
      <p class="form-control-static">
        {{ "%.2f"|format((shipment.weight ?: tracker.weight) / 16) }} lbs.
      </p>
    </div>

    {% if tracker %}
      <div class="form-group">
        <label class="control-label">Carrier</label>
        <p class="form-control-static">
          {{ tracker.carrier }}
        </p>
      </div>

      <div class="form-group">
        <label class="control-label">Service</label>
        <p class="form-control-static">
          {{ tracker.carrier_detail.service }}
        </p>
      </div>

      <div class="form-group">
        <label class="control-label">Tracking Code</label>
        <p class="form-control-static">
          <a href="//rawm.us/track/{{ tracker.carrier|lower }}/{{ tracker.tracking_code }}" target="_blank">
            {{ tracker.tracking_code }}
          </a>
        </p>
      </div>

    {% endif %}

    {% if easypost.selected_rate %}
      <div class="form-group">
        <label class="control-label">Rate</label>
        <p class="form-control-static">
          {{ scat.amount(easypost.selected_rate.rate) }}
        </p>
      </div>
    {% endif %}

  </div>
{% endblock %}

{% block submit %}
  {% if tracker %}
    <a class="btn btn-primary"
        href="/shipment/{{ shipment.id }}/track" target="_blank">
      Track
    </a>
  {% endif %}
{% endblock %}

{% block script %}
  form.onsubmit= (event) => {
    event.preventDefault()

    $(dialog).modal('hide')
  }
{% endblock %}
